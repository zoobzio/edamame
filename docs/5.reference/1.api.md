---
title: API Reference
description: Complete API reference for the edamame package
author: zoobzio
published: 2025-12-17
updated: 2025-12-17
tags:
  - Reference
  - API
  - Functions
  - Types
---

# API Reference

Complete API reference for the `github.com/zoobzio/edamame` package.

## Factory

The main coordinator type for a model.

### New

```go
func New[T any](db *sqlx.DB, tableName string) (*Factory[T], error)
```

Creates a new factory for type T bound to the given table. Registers default CRUD capabilities automatically. The `db` parameter can be nil for testing capability registration without database access.

## Factory Methods

### Capability Registration

#### AddQuery

```go
func (f *Factory[T]) AddQuery(cap QueryCapability)
```

Registers a query capability. Params are auto-derived from the spec if not provided.

#### AddSelect

```go
func (f *Factory[T]) AddSelect(cap SelectCapability)
```

Registers a select capability.

#### AddUpdate

```go
func (f *Factory[T]) AddUpdate(cap UpdateCapability)
```

Registers an update capability.

#### AddDelete

```go
func (f *Factory[T]) AddDelete(cap DeleteCapability)
```

Registers a delete capability.

#### AddAggregate

```go
func (f *Factory[T]) AddAggregate(cap AggregateCapability)
```

Registers an aggregate capability.

### Capability Lookup

#### HasQuery / HasSelect / HasUpdate / HasDelete / HasAggregate

```go
func (f *Factory[T]) HasQuery(name string) bool
func (f *Factory[T]) HasSelect(name string) bool
func (f *Factory[T]) HasUpdate(name string) bool
func (f *Factory[T]) HasDelete(name string) bool
func (f *Factory[T]) HasAggregate(name string) bool
```

Returns true if a capability with the given name exists.

#### GetQuery / GetSelect / GetUpdate / GetDelete / GetAggregate

```go
func (f *Factory[T]) GetQuery(name string) (QueryCapability, bool)
func (f *Factory[T]) GetSelect(name string) (SelectCapability, bool)
func (f *Factory[T]) GetUpdate(name string) (UpdateCapability, bool)
func (f *Factory[T]) GetDelete(name string) (DeleteCapability, bool)
func (f *Factory[T]) GetAggregate(name string) (AggregateCapability, bool)
```

Returns the capability and true if found, or zero value and false if not.

#### ListQueries / ListSelects / ListUpdates / ListDeletes / ListAggregates

```go
func (f *Factory[T]) ListQueries() []string
func (f *Factory[T]) ListSelects() []string
func (f *Factory[T]) ListUpdates() []string
func (f *Factory[T]) ListDeletes() []string
func (f *Factory[T]) ListAggregates() []string
```

Returns names of all registered capabilities of that type.

### Capability Removal

#### RemoveQuery / RemoveSelect / RemoveUpdate / RemoveDelete / RemoveAggregate

```go
func (f *Factory[T]) RemoveQuery(name string) bool
func (f *Factory[T]) RemoveSelect(name string) bool
func (f *Factory[T]) RemoveUpdate(name string) bool
func (f *Factory[T]) RemoveDelete(name string) bool
func (f *Factory[T]) RemoveAggregate(name string) bool
```

Removes a capability. Returns true if it existed.

### Builder Access

#### Query

```go
func (f *Factory[T]) Query(name string) (*cereal.Query[T], error)
```

Returns a cereal Query builder for the named capability.

#### Select

```go
func (f *Factory[T]) Select(name string) (*cereal.Select[T], error)
```

Returns a cereal Select builder for the named capability.

#### Update

```go
func (f *Factory[T]) Update(name string) (*cereal.Update[T], error)
```

Returns a cereal Update builder for the named capability.

#### Delete

```go
func (f *Factory[T]) Delete(name string) (*cereal.Delete[T], error)
```

Returns a cereal Delete builder for the named capability.

#### Aggregate

```go
func (f *Factory[T]) Aggregate(name string) (*cereal.Aggregate[T], error)
```

Returns a cereal Aggregate builder for the named capability.

#### Insert

```go
func (f *Factory[T]) Insert() *cereal.Create[T]
```

Returns a cereal Create builder for inserts.

### Execution Methods

#### ExecQuery / ExecQueryTx

```go
func (f *Factory[T]) ExecQuery(ctx context.Context, name string, params map[string]any) ([]*T, error)
func (f *Factory[T]) ExecQueryTx(ctx context.Context, tx *sqlx.Tx, name string, params map[string]any) ([]*T, error)
```

Executes a query capability, returning multiple records.

#### ExecSelect / ExecSelectTx

```go
func (f *Factory[T]) ExecSelect(ctx context.Context, name string, params map[string]any) (*T, error)
func (f *Factory[T]) ExecSelectTx(ctx context.Context, tx *sqlx.Tx, name string, params map[string]any) (*T, error)
```

Executes a select capability, returning a single record.

#### ExecUpdate / ExecUpdateTx

```go
func (f *Factory[T]) ExecUpdate(ctx context.Context, name string, params map[string]any) (*T, error)
func (f *Factory[T]) ExecUpdateTx(ctx context.Context, tx *sqlx.Tx, name string, params map[string]any) (*T, error)
```

Executes an update capability, returning the updated record.

#### ExecDelete / ExecDeleteTx

```go
func (f *Factory[T]) ExecDelete(ctx context.Context, name string, params map[string]any) (int64, error)
func (f *Factory[T]) ExecDeleteTx(ctx context.Context, tx *sqlx.Tx, name string, params map[string]any) (int64, error)
```

Executes a delete capability, returning the count of deleted rows.

#### ExecAggregate / ExecAggregateTx

```go
func (f *Factory[T]) ExecAggregate(ctx context.Context, name string, params map[string]any) (float64, error)
func (f *Factory[T]) ExecAggregateTx(ctx context.Context, tx *sqlx.Tx, name string, params map[string]any) (float64, error)
```

Executes an aggregate capability, returning the result.

#### ExecInsert / ExecInsertTx

```go
func (f *Factory[T]) ExecInsert(ctx context.Context, record *T) (*T, error)
func (f *Factory[T]) ExecInsertTx(ctx context.Context, tx *sqlx.Tx, record *T) (*T, error)
```

Inserts a record, returning it with generated fields populated.

### Batch Execution

#### ExecInsertBatch / ExecInsertBatchTx

```go
func (f *Factory[T]) ExecInsertBatch(ctx context.Context, records []*T) (int64, error)
func (f *Factory[T]) ExecInsertBatchTx(ctx context.Context, tx *sqlx.Tx, records []*T) (int64, error)
```

Inserts multiple records, returning the count.

#### ExecUpdateBatch / ExecUpdateBatchTx

```go
func (f *Factory[T]) ExecUpdateBatch(ctx context.Context, name string, batchParams []map[string]any) (int64, error)
func (f *Factory[T]) ExecUpdateBatchTx(ctx context.Context, tx *sqlx.Tx, name string, batchParams []map[string]any) (int64, error)
```

Executes an update capability with multiple parameter sets.

#### ExecDeleteBatch / ExecDeleteBatchTx

```go
func (f *Factory[T]) ExecDeleteBatch(ctx context.Context, name string, batchParams []map[string]any) (int64, error)
func (f *Factory[T]) ExecDeleteBatchTx(ctx context.Context, tx *sqlx.Tx, name string, batchParams []map[string]any) (int64, error)
```

Executes a delete capability with multiple parameter sets.

### Rendering

#### RenderQuery / RenderSelect / RenderUpdate / RenderDelete / RenderAggregate

```go
func (f *Factory[T]) RenderQuery(name string) (string, error)
func (f *Factory[T]) RenderSelect(name string) (string, error)
func (f *Factory[T]) RenderUpdate(name string) (string, error)
func (f *Factory[T]) RenderDelete(name string) (string, error)
func (f *Factory[T]) RenderAggregate(name string) (string, error)
```

Renders a capability to SQL for inspection or debugging.

### Introspection

#### Spec

```go
func (f *Factory[T]) Spec() FactorySpec
```

Returns the factory specification as Go structs.

#### SpecJSON

```go
func (f *Factory[T]) SpecJSON() (string, error)
```

Returns the factory specification as a JSON string.

### Other

#### Cereal

```go
func (f *Factory[T]) Cereal() *cereal.Cereal[T]
```

Returns the underlying cereal instance for direct builder access.

#### TableName

```go
func (f *Factory[T]) TableName() string
```

Returns the table name.

## Capability Types

### QueryCapability

```go
type QueryCapability struct {
    Name        string
    Description string
    Spec        QuerySpec
    Params      []ParamSpec
    Tags        []string
}
```

### SelectCapability

```go
type SelectCapability struct {
    Name        string
    Description string
    Spec        SelectSpec
    Params      []ParamSpec
    Tags        []string
}
```

### UpdateCapability

```go
type UpdateCapability struct {
    Name        string
    Description string
    Spec        UpdateSpec
    Params      []ParamSpec
    Tags        []string
}
```

### DeleteCapability

```go
type DeleteCapability struct {
    Name        string
    Description string
    Spec        DeleteSpec
    Params      []ParamSpec
    Tags        []string
}
```

### AggregateCapability

```go
type AggregateCapability struct {
    Name        string
    Description string
    Spec        AggregateSpec
    Func        AggregateFunc
    Params      []ParamSpec
    Tags        []string
}
```

## Spec Types

### QuerySpec

```go
type QuerySpec struct {
    Fields     []string
    Where      []ConditionSpec
    OrderBy    []OrderBySpec
    GroupBy    []string
    Having     []ConditionSpec
    HavingAgg  []HavingAggSpec
    Limit      *int
    Offset     *int
    Distinct   bool
    DistinctOn []string
    ForLocking string
}
```

### SelectSpec

```go
type SelectSpec struct {
    Fields     []string
    Where      []ConditionSpec
    OrderBy    []OrderBySpec
    GroupBy    []string
    Having     []ConditionSpec
    HavingAgg  []HavingAggSpec
    Limit      *int
    Offset     *int
    Distinct   bool
    DistinctOn []string
    ForLocking string
}
```

### UpdateSpec

```go
type UpdateSpec struct {
    Set   map[string]string  // field -> param
    Where []ConditionSpec
}
```

### DeleteSpec

```go
type DeleteSpec struct {
    Where []ConditionSpec
}
```

### AggregateSpec

```go
type AggregateSpec struct {
    Field string
    Where []ConditionSpec
}
```

### ConditionSpec

```go
type ConditionSpec struct {
    Field    string
    Operator string
    Param    string
    IsNull   bool
    Logic    string           // "AND" or "OR" for groups
    Group    []ConditionSpec  // Nested conditions
}
```

### OrderBySpec

```go
type OrderBySpec struct {
    Field     string
    Direction string  // "asc" or "desc"
    Nulls     string  // "first" or "last"
    Operator  string  // For expressions (e.g., "<->")
    Param     string  // For expression parameters
}
```

### ParamSpec

```go
type ParamSpec struct {
    Name        string
    Type        string
    Required    bool
    Default     any
    Description string
}
```

## AggregateFunc

```go
type AggregateFunc string

const (
    AggCount AggregateFunc = "COUNT"
    AggSum   AggregateFunc = "SUM"
    AggAvg   AggregateFunc = "AVG"
    AggMin   AggregateFunc = "MIN"
    AggMax   AggregateFunc = "MAX"
)
```

## Event Keys

```go
var (
    KeyTable      = capitan.NewStringKey("table")
    KeyCapability = capitan.NewStringKey("capability")
    KeyType       = capitan.NewStringKey("type")
    KeyError      = capitan.NewStringKey("error")
    KeyDuration   = capitan.NewDurationKey("duration")
)
```

## Signals

```go
var (
    FactoryCreated     = capitan.NewSignal("edamame.factory.created", "Factory instance created")
    CapabilityAdded    = capitan.NewSignal("edamame.capability.added", "Capability registered")
    CapabilityRemoved  = capitan.NewSignal("edamame.capability.removed", "Capability removed")
    CapabilityNotFound = capitan.NewSignal("edamame.capability.not_found", "Capability not found")
    PrimaryKeyNotFound = capitan.NewSignal("edamame.primarykey.not_found", "No primary key constraint found")
)
```

## FactorySpec

```go
type FactorySpec struct {
    Table      string
    Schema     SchemaSpec
    Queries    []QueryCapabilitySpec
    Selects    []SelectCapabilitySpec
    Updates    []UpdateCapabilitySpec
    Deletes    []DeleteCapabilitySpec
    Aggregates []AggregateCapabilitySpec
}
```

Returned by `factory.Spec()` for introspection and JSON export.

## SchemaSpec

```go
type SchemaSpec struct {
    PrimaryKey string
    Fields     []FieldSpec
}
```

Describes the table schema derived from struct metadata.

## FieldSpec

```go
type FieldSpec struct {
    Name        string
    Type        string
    Nullable    bool
    Constraints []string
}
```

Describes a single field in the schema.
