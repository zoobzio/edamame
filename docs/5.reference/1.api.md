---
title: API Reference
description: Complete API reference for the edamame package
author: zoobzio
published: 2025-12-17
updated: 2026-01-02
tags:
  - Reference
  - API
  - Functions
  - Types
---

# API Reference

Complete API reference for the `github.com/zoobzio/edamame` package.

## Factory

The main coordinator type for a model.

### New

```go
func New[T any](db *sqlx.DB, tableName string, renderer astql.Renderer) (*Factory[T], error)
```

Creates a new factory for type T bound to the given table with the specified SQL renderer. Registers default CRUD capabilities automatically. The `db` parameter can be nil for testing capability registration without database access.

Supported renderers via [astql](https://github.com/zoobzio/astql):
- `github.com/zoobzio/astql/pkg/postgres` - PostgreSQL
- `github.com/zoobzio/astql/pkg/mysql` - MySQL
- `github.com/zoobzio/astql/pkg/sqlite` - SQLite
- `github.com/zoobzio/astql/pkg/mssql` - SQL Server

```go
import "github.com/zoobzio/astql/pkg/postgres" // or mysql, sqlite, mssql

factory, err := edamame.New[User](db, "users", postgres.New())
```

## Factory Methods

### Capability Registration

#### AddQuery

```go
func (f *Factory[T]) AddQuery(cap QueryCapability) error
```

Registers a query capability. Params are auto-derived from the spec if not provided. Returns an error if condition depth exceeds the configured maximum.

#### AddSelect

```go
func (f *Factory[T]) AddSelect(cap SelectCapability) error
```

Registers a select capability. Returns an error if condition depth exceeds the configured maximum.

#### AddUpdate

```go
func (f *Factory[T]) AddUpdate(cap UpdateCapability) error
```

Registers an update capability. Returns an error if condition depth exceeds the configured maximum.

#### AddDelete

```go
func (f *Factory[T]) AddDelete(cap DeleteCapability) error
```

Registers a delete capability. Returns an error if condition depth exceeds the configured maximum.

#### AddAggregate

```go
func (f *Factory[T]) AddAggregate(cap AggregateCapability) error
```

Registers an aggregate capability. Returns an error if condition depth exceeds the configured maximum.

### Capability Lookup

#### HasQuery / HasSelect / HasUpdate / HasDelete / HasAggregate

```go
func (f *Factory[T]) HasQuery(name string) bool
func (f *Factory[T]) HasSelect(name string) bool
func (f *Factory[T]) HasUpdate(name string) bool
func (f *Factory[T]) HasDelete(name string) bool
func (f *Factory[T]) HasAggregate(name string) bool
```

Returns true if a capability with the given name exists.

#### GetQuery / GetSelect / GetUpdate / GetDelete / GetAggregate

```go
func (f *Factory[T]) GetQuery(name string) (QueryCapability, bool)
func (f *Factory[T]) GetSelect(name string) (SelectCapability, bool)
func (f *Factory[T]) GetUpdate(name string) (UpdateCapability, bool)
func (f *Factory[T]) GetDelete(name string) (DeleteCapability, bool)
func (f *Factory[T]) GetAggregate(name string) (AggregateCapability, bool)
```

Returns the capability and true if found, or zero value and false if not.

#### ListQueries / ListSelects / ListUpdates / ListDeletes / ListAggregates

```go
func (f *Factory[T]) ListQueries() []string
func (f *Factory[T]) ListSelects() []string
func (f *Factory[T]) ListUpdates() []string
func (f *Factory[T]) ListDeletes() []string
func (f *Factory[T]) ListAggregates() []string
```

Returns names of all registered capabilities of that type.

### Capability Removal

#### RemoveQuery / RemoveSelect / RemoveUpdate / RemoveDelete / RemoveAggregate

```go
func (f *Factory[T]) RemoveQuery(name string) bool
func (f *Factory[T]) RemoveSelect(name string) bool
func (f *Factory[T]) RemoveUpdate(name string) bool
func (f *Factory[T]) RemoveDelete(name string) bool
func (f *Factory[T]) RemoveAggregate(name string) bool
```

Removes a capability. Returns true if it existed.

### Builder Access

#### Query

```go
func (f *Factory[T]) Query(name string) (*soy.Query[T], error)
```

Returns a soy Query builder for the named capability.

#### Select

```go
func (f *Factory[T]) Select(name string) (*soy.Select[T], error)
```

Returns a soy Select builder for the named capability.

#### Update

```go
func (f *Factory[T]) Update(name string) (*soy.Update[T], error)
```

Returns a soy Update builder for the named capability.

#### Delete

```go
func (f *Factory[T]) Delete(name string) (*soy.Delete[T], error)
```

Returns a soy Delete builder for the named capability.

#### Aggregate

```go
func (f *Factory[T]) Aggregate(name string) (*soy.Aggregate[T], error)
```

Returns a soy Aggregate builder for the named capability.

#### Insert

```go
func (f *Factory[T]) Insert() *soy.Create[T]
```

Returns a soy Create builder for inserts.

#### Compound

```go
func (f *Factory[T]) Compound(spec CompoundQuerySpec) (*soy.Compound[T], error)
```

Returns a soy Compound builder for set operations (UNION, INTERSECT, EXCEPT). Unlike other operations, compound queries are constructed directly from a spec rather than registered as capabilities.

### Execution Methods

#### ExecQuery / ExecQueryTx

```go
func (f *Factory[T]) ExecQuery(ctx context.Context, name string, params map[string]any) ([]*T, error)
func (f *Factory[T]) ExecQueryTx(ctx context.Context, tx *sqlx.Tx, name string, params map[string]any) ([]*T, error)
```

Executes a query capability, returning multiple records.

#### ExecSelect / ExecSelectTx

```go
func (f *Factory[T]) ExecSelect(ctx context.Context, name string, params map[string]any) (*T, error)
func (f *Factory[T]) ExecSelectTx(ctx context.Context, tx *sqlx.Tx, name string, params map[string]any) (*T, error)
```

Executes a select capability, returning a single record.

#### ExecUpdate / ExecUpdateTx

```go
func (f *Factory[T]) ExecUpdate(ctx context.Context, name string, params map[string]any) (*T, error)
func (f *Factory[T]) ExecUpdateTx(ctx context.Context, tx *sqlx.Tx, name string, params map[string]any) (*T, error)
```

Executes an update capability, returning the updated record.

#### ExecDelete / ExecDeleteTx

```go
func (f *Factory[T]) ExecDelete(ctx context.Context, name string, params map[string]any) (int64, error)
func (f *Factory[T]) ExecDeleteTx(ctx context.Context, tx *sqlx.Tx, name string, params map[string]any) (int64, error)
```

Executes a delete capability, returning the count of deleted rows.

#### ExecAggregate / ExecAggregateTx

```go
func (f *Factory[T]) ExecAggregate(ctx context.Context, name string, params map[string]any) (float64, error)
func (f *Factory[T]) ExecAggregateTx(ctx context.Context, tx *sqlx.Tx, name string, params map[string]any) (float64, error)
```

Executes an aggregate capability, returning the result.

#### ExecInsert / ExecInsertTx

```go
func (f *Factory[T]) ExecInsert(ctx context.Context, record *T) (*T, error)
func (f *Factory[T]) ExecInsertTx(ctx context.Context, tx *sqlx.Tx, record *T) (*T, error)
```

Inserts a record, returning it with generated fields populated.

#### ExecCompound / ExecCompoundTx

```go
func (f *Factory[T]) ExecCompound(ctx context.Context, spec CompoundQuerySpec, params map[string]any) ([]*T, error)
func (f *Factory[T]) ExecCompoundTx(ctx context.Context, tx *sqlx.Tx, spec CompoundQuerySpec, params map[string]any) ([]*T, error)
```

Executes a compound query (UNION, INTERSECT, EXCEPT), returning multiple records.

### Batch Execution

#### ExecInsertBatch / ExecInsertBatchTx

```go
func (f *Factory[T]) ExecInsertBatch(ctx context.Context, records []*T) (int64, error)
func (f *Factory[T]) ExecInsertBatchTx(ctx context.Context, tx *sqlx.Tx, records []*T) (int64, error)
```

Inserts multiple records, returning the count.

#### ExecUpdateBatch / ExecUpdateBatchTx

```go
func (f *Factory[T]) ExecUpdateBatch(ctx context.Context, name string, batchParams []map[string]any) (int64, error)
func (f *Factory[T]) ExecUpdateBatchTx(ctx context.Context, tx *sqlx.Tx, name string, batchParams []map[string]any) (int64, error)
```

Executes an update capability with multiple parameter sets.

#### ExecDeleteBatch / ExecDeleteBatchTx

```go
func (f *Factory[T]) ExecDeleteBatch(ctx context.Context, name string, batchParams []map[string]any) (int64, error)
func (f *Factory[T]) ExecDeleteBatchTx(ctx context.Context, tx *sqlx.Tx, name string, batchParams []map[string]any) (int64, error)
```

Executes a delete capability with multiple parameter sets.

### Type-Erased Execution

These methods return `*atom.Atom` instead of typed results, enabling execution where `T` is not known at consumption time.

#### ExecQueryAtom

```go
func (f *Factory[T]) ExecQueryAtom(ctx context.Context, name string, params map[string]any) ([]*atom.Atom, error)
```

Executes a query capability and returns results as Atoms.

#### ExecSelectAtom

```go
func (f *Factory[T]) ExecSelectAtom(ctx context.Context, name string, params map[string]any) (*atom.Atom, error)
```

Executes a select capability and returns the result as an Atom.

#### ExecInsertAtom

```go
func (f *Factory[T]) ExecInsertAtom(ctx context.Context, params map[string]any) (*atom.Atom, error)
```

Executes an insert and returns the result as an Atom.

### Rendering

#### RenderQuery / RenderSelect / RenderUpdate / RenderDelete / RenderAggregate

```go
func (f *Factory[T]) RenderQuery(name string) (string, error)
func (f *Factory[T]) RenderSelect(name string) (string, error)
func (f *Factory[T]) RenderUpdate(name string) (string, error)
func (f *Factory[T]) RenderDelete(name string) (string, error)
func (f *Factory[T]) RenderAggregate(name string) (string, error)
```

Renders a capability to SQL for inspection or debugging.

#### RenderCompound

```go
func (f *Factory[T]) RenderCompound(spec CompoundQuerySpec) (string, error)
```

Renders a compound query to SQL for inspection or debugging.

### Introspection

#### Spec

```go
func (f *Factory[T]) Spec() FactorySpec
```

Returns the factory specification as Go structs.

#### SpecJSON

```go
func (f *Factory[T]) SpecJSON() (string, error)
```

Returns the factory specification as a JSON string.

### Other

#### Soy

```go
func (f *Factory[T]) Soy() *soy.Soy[T]
```

Returns the underlying soy instance for direct builder access.

#### TableName

```go
func (f *Factory[T]) TableName() string
```

Returns the table name.

### Configuration

#### SetMaxConditionDepth

```go
func (f *Factory[T]) SetMaxConditionDepth(depth int)
```

Sets the maximum nesting depth for condition groups. Set to 0 to disable depth validation. Default is 10.

#### MaxConditionDepth

```go
func (f *Factory[T]) MaxConditionDepth() int
```

Returns the current maximum condition depth setting.

## Capability Types

### QueryCapability

```go
type QueryCapability struct {
    Name        string
    Description string
    Spec        QuerySpec
    Params      []ParamSpec
    Tags        []string
}
```

### SelectCapability

```go
type SelectCapability struct {
    Name        string
    Description string
    Spec        SelectSpec
    Params      []ParamSpec
    Tags        []string
}
```

### UpdateCapability

```go
type UpdateCapability struct {
    Name        string
    Description string
    Spec        UpdateSpec
    Params      []ParamSpec
    Tags        []string
}
```

### DeleteCapability

```go
type DeleteCapability struct {
    Name        string
    Description string
    Spec        DeleteSpec
    Params      []ParamSpec
    Tags        []string
}
```

### AggregateCapability

```go
type AggregateCapability struct {
    Name        string
    Description string
    Spec        AggregateSpec
    Func        AggregateFunc
    Params      []ParamSpec
    Tags        []string
}
```

## Spec Types

### QuerySpec

```go
type QuerySpec struct {
    Fields      []string
    SelectExprs []SelectExprSpec  // Expression-based SELECT (functions, aggregates)
    Where       []ConditionSpec
    OrderBy     []OrderBySpec
    GroupBy     []string
    Having      []ConditionSpec
    HavingAgg   []HavingAggSpec
    Limit       *int
    LimitParam  string            // Parameterized LIMIT
    Offset      *int
    OffsetParam string            // Parameterized OFFSET
    Distinct    bool
    DistinctOn  []string
    ForLocking  string
}
```

### SelectSpec

```go
type SelectSpec struct {
    Fields      []string
    SelectExprs []SelectExprSpec  // Expression-based SELECT (functions, aggregates)
    Where       []ConditionSpec
    OrderBy     []OrderBySpec
    GroupBy     []string
    Having      []ConditionSpec
    HavingAgg   []HavingAggSpec
    Limit       *int
    LimitParam  string            // Parameterized LIMIT
    Offset      *int
    OffsetParam string            // Parameterized OFFSET
    Distinct    bool
    DistinctOn  []string
    ForLocking  string
}
```

### UpdateSpec

```go
type UpdateSpec struct {
    Set   map[string]string  // field -> param
    Where []ConditionSpec
}
```

### DeleteSpec

```go
type DeleteSpec struct {
    Where []ConditionSpec
}
```

### AggregateSpec

```go
type AggregateSpec struct {
    Field string
    Where []ConditionSpec
}
```

### ConditionSpec

```go
type ConditionSpec struct {
    Field      string
    Operator   string
    Param      string
    IsNull     bool
    Logic      string           // "AND" or "OR" for groups
    Group      []ConditionSpec  // Nested conditions
    Between    bool             // Use BETWEEN with LowParam/HighParam
    NotBetween bool             // Use NOT BETWEEN with LowParam/HighParam
    LowParam   string           // Lower bound param for BETWEEN
    HighParam  string           // Upper bound param for BETWEEN
    RightField string           // For field-to-field comparisons (WHERE a.field = b.field)
}
```

#### Helper Methods

```go
func (c ConditionSpec) IsGroup() bool           // Returns true if this is a grouped condition
func (c ConditionSpec) IsBetween() bool         // Returns true if Between is set
func (c ConditionSpec) IsNotBetween() bool      // Returns true if NotBetween is set
func (c ConditionSpec) IsFieldComparison() bool // Returns true if RightField is set
```

### OrderBySpec

```go
type OrderBySpec struct {
    Field     string
    Direction string  // "asc" or "desc"
    Nulls     string  // "first" or "last"
    Operator  string  // For expressions (e.g., "<->")
    Param     string  // For expression parameters
}
```

### ParamSpec

```go
type ParamSpec struct {
    Name        string
    Type        string
    Required    bool
    Default     any
    Description string
}
```

### SelectExprSpec

Defines expression-based SELECT columns (functions, aggregates, casts).

```go
type SelectExprSpec struct {
    Func     string          // Function name (see supported functions below)
    Field    string          // Primary field for single-field functions
    Fields   []string        // Multiple fields for multi-field functions (concat)
    Params   []string        // Additional parameters (substring positions, power exponent)
    CastType string          // Target type for cast operations
    Filter   *ConditionSpec  // Filter clause for aggregate functions
    Alias    string          // Required: column alias in result
}
```

**Supported Functions:**

| Category | Functions |
|----------|-----------|
| String | `upper`, `lower`, `length`, `trim`, `ltrim`, `rtrim`, `substring`, `replace`, `concat` |
| Math | `abs`, `ceil`, `floor`, `round`, `sqrt`, `power` |
| Date/Time | `now`, `current_date`, `current_time`, `current_timestamp` |
| Type | `cast` |
| Aggregate | `count`, `count_star`, `count_distinct`, `sum`, `avg`, `min`, `max` |
| Conditional | `coalesce`, `nullif` |

### HavingAggSpec

Defines aggregate conditions for HAVING clauses.

```go
type HavingAggSpec struct {
    Func     string  // Aggregate function: "count", "sum", "avg", "min", "max"
    Field    string  // Field to aggregate
    Operator string  // Comparison operator
    Param    string  // Parameter name for comparison value
}
```

### CompoundQuerySpec

Defines compound queries using set operations (UNION, INTERSECT, EXCEPT).

```go
type CompoundQuerySpec struct {
    Base     QuerySpec         // The base query
    Operands []CompoundOperand // Set operations with additional queries
    OrderBy  []OrderBySpec     // Final ORDER BY (applies to combined result)
    Limit    *int              // Final LIMIT
    Offset   *int              // Final OFFSET
}
```

### CompoundOperand

Defines a set operation in a compound query.

```go
type CompoundOperand struct {
    Operation string    // "union", "union_all", "intersect", "intersect_all", "except", "except_all"
    Query     QuerySpec // The query to combine
}
```

## AggregateFunc

```go
type AggregateFunc string

const (
    AggCount AggregateFunc = "COUNT"
    AggSum   AggregateFunc = "SUM"
    AggAvg   AggregateFunc = "AVG"
    AggMin   AggregateFunc = "MIN"
    AggMax   AggregateFunc = "MAX"
)
```

## Event Keys

```go
var (
    KeyTable      = capitan.NewStringKey("table")
    KeyCapability = capitan.NewStringKey("capability")
    KeyType       = capitan.NewStringKey("type")
    KeyError      = capitan.NewStringKey("error")
    KeyDuration   = capitan.NewDurationKey("duration")
)
```

## Signals

```go
var (
    FactoryCreated     = capitan.NewSignal("edamame.factory.created", "Factory instance created")
    CapabilityAdded    = capitan.NewSignal("edamame.capability.added", "Capability registered")
    CapabilityRemoved  = capitan.NewSignal("edamame.capability.removed", "Capability removed")
    CapabilityNotFound = capitan.NewSignal("edamame.capability.not_found", "Capability not found")
    PrimaryKeyNotFound = capitan.NewSignal("edamame.primarykey.not_found", "No primary key constraint found")
)
```

## FactorySpec

```go
type FactorySpec struct {
    Table      string
    Schema     SchemaSpec
    Queries    []QueryCapabilitySpec
    Selects    []SelectCapabilitySpec
    Updates    []UpdateCapabilitySpec
    Deletes    []DeleteCapabilitySpec
    Aggregates []AggregateCapabilitySpec
}
```

Returned by `factory.Spec()` for introspection and JSON export.

## SchemaSpec

```go
type SchemaSpec struct {
    PrimaryKey string
    Fields     []FieldSpec
}
```

Describes the table schema derived from struct metadata.

## FieldSpec

```go
type FieldSpec struct {
    Name        string
    Type        string
    Nullable    bool
    Constraints []string
}
```

Describes a single field in the schema.
